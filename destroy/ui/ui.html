<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo Game UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/css" rel="stylesheet" href="./ui.css">
  
    <style>
        #intro {
            /* top: 50%; */
        }

        #complete_nextBtn , #intro_startBtn , #settings_applyBtn {
            background-color: rgb(13, 134, 255);
        }

        #complete_nextBtn:hover , #intro_startBtn:hover , #settings_applyBtn:hover {
            background: rgb(6, 85, 165);
            text-shadow: black 0px 0px;
            
        }

        p {
            display: grid;
        }
    </style>
  
</head>
<body>
    <main id="main">
        <div id="intro" class="ui-panel">
            <h2>Destroy Everything!</h2>
            <button id="intro_startBtn">Play Game</button>
            <button id="intro_aboutBtn">About</button>

            <h4>
                You got 15 seconds to Destroy all buildings!
            </h4>
            
            
        </div>
        <div id="timeup" class="ui-panel">
            <h2>Time is up!</h2>
            <h3>Your score is:</h3>
            <h1 id="timeup_score">750</h1>
            <button id="timeup_againBtn">Try again</button>
            
        </div>
        <div id="complete" class="ui-panel">
            <h3>Mission</h3>
            <h3 style="margin-left: -0.2em;">Accomplished!</h3>
            <h4>Your score is:</h4>
            <h1 id="complete_score">1000</h1>
            <button id="complete_againBtn">Try again</button>
            <button id="complete_nextBtn">Next Level</button>
           
        </div>
        <div id="about" class="ui-panel">
            <h2>About:</h2>
            <p>Destroy Everything is an online RAGE ROOM type of game.</p>
            <p>Take out your frustration and gain satisfaction from destruction of pretty buildings</p>
            <button id="about_startBtn">Play Game</button> 
        </div>
        <div id="settings" class="ui-panel">
            <form action="../" method="get" target="_parent">
            <h2>Settings:</h2>
            <p>Qaulity: 
                <select id="quality" name="quality">
                    <option value="0">LOWEST</option>
                    <option value="1">LOW</option>
                    <option value="2">MEDIUM</option>
                    <option value="3">HIGH</option>
                    <!-- <option value="4">HIGHEST</option> -->
                </select>
            </p>
            <p>Game Type:
                <select id="mobile" name="mobile">
                    <option value="true">MOBILE</option>
                    <option value="false">DESKTOP</option>
                </select>
            </p>
            <p><nobr>Show Stats:</nobr> 
                <select id="statsSelect" name="stats">
                    <option value="0">OFF</option>
                    <option value="1">ON</option>
                </select>
            </p>
            <button id="settings_cancelBtn" onclick="return false">Cancel</button> 
            <button id="settings_applyBtn">Apply</button> 
           
            </form>
        </div>

      
    </main>

    
    <script>
        function startBtnClick(){
            hideOthers();
            window.parent.startGame();
        }
    
        intro_startBtn.addEventListener('click', startBtnClick);

        about_startBtn.addEventListener('click', startBtnClick);
        

        settings_cancelBtn.addEventListener('click' , () => {
            settings.style.top = "-50%";
            intro.style.top = "50%";
        })

       

        timeup_againBtn.addEventListener('click', startBtnClick);

        intro_aboutBtn.addEventListener('click', function() {
            hideOthers();
            about.style.top = '50%';
        });

        complete_againBtn.addEventListener('click', startBtnClick);

        complete_nextBtn.addEventListener('click', function() {
            hideOthers();
            window.parent.nextLevel();
        });

        function hideOthers(){
            intro.style.top = '-50%';
            timeup.style.top = '-50%';
            complete.style.top = '-50%';
            about.style.top = '-50%';
            settings.style.top = '-50%';
        }


        let scoreTarget = 0;
        let runningScore = 0;
        function showTimeUp(score){
            hideOthers();
            timeup.style.top = '50%';

            scoreTarget = score;
            runningScore = 0;
            requestAnimationFrame(animateScore);


            timeup_againBtn.style.visibility = 'hidden'
            setTimeout ( () => {timeup_againBtn.style.visibility = 'visible'} , 1000);
        }

        function showSettings(game,stats){
            hideOthers();
            settings.style.top = '50%';

            for(let i = 0 ; i < quality.options.length ; i++){
                if(quality.options[i].value == game.quality){
                    quality.selectedIndex = i;
                }
            }
            //quality.selectedIndex

            if(game.isMobile == false){
                mobile.selectedIndex = 1;
            }
            console.log(stats)
           if(stats){
               statsSelect.selectedIndex = 1;
            }
        }

        function animateScore(){
            if(scoreTarget - runningScore < 0.1)runningScore = scoreTarget;
            if(runningScore < scoreTarget){
                runningScore += Math.min( (scoreTarget - runningScore) * 0.1 , 11);
                //runningScore++;
                requestAnimationFrame(animateScore);
            }
            timeup_score.innerText = Math.round(runningScore) ;
            complete_score.innerText = Math.round(runningScore) ;
        }

        function showMissionComplete(score = 1000){
            hideOthers();


            scoreTarget = score;
            runningScore = 0;
            requestAnimationFrame(animateScore);
            //complete_score.innerText = score ;

            complete.style.top = '50%';

            complete_againBtn.style.visibility = 'hidden'
            setTimeout ( () => {complete_againBtn.style.visibility = 'visible'} , 1500);

            complete_nextBtn.style.visibility = 'hidden'
            setTimeout ( () => {complete_nextBtn.style.visibility = 'visible'} , 1000);
        }

        function windowResized(e){
            
            let aspect = window.innerWidth / window.innerHeight;
            console.log(window.devicePixelRatio)

         
            if(aspect>1.0   )
                main.style.zoom = Math.min(window.innerHeight / 325 , 1.25) ;
            else
                main.style.zoom =   Math.min(window.innerWidth / 325 , 1.25) ;

            
        }

        window.addEventListener('resize' , windowResized);
        document.body.onload = () => {
            intro.style.top = "50%"
            windowResized();
        };
    </script>
</body>
</html>